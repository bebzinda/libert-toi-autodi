<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Libert_Toi_AutoDi | Espace Client</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- FAVICON + PWA -->
  <link rel="icon" type="image/png" href="images/favicon.png">
  <link rel="apple-touch-icon" href="images/logo.png">
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#1e90ff">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <style>
    body { margin:0; font-family:'Segoe UI', Arial, sans-serif; background:#f5f7fa; color:#333; }

    /* ===== Bandeau offline ===== */
    #offline-banner {
      display:none;
      position:fixed;
      top:-50px;
      left:0;
      width:100%;
      background:#ff4d4f;
      color:white;
      text-align:center;
      padding:12px 0;
      font-weight:bold;
      z-index:9999;
      transition: top 0.5s ease;
    }
    #offline-banner.show { top:0; }

    /* ===== Header ===== */
    header {
      background: linear-gradient(135deg, #1e90ff, #0b5ed7);
      color:white; padding:40px 20px; text-align:center;
      overflow:hidden;
    }
    header img { height:70px; margin-bottom:10px; opacity:0; transform: translateY(-50px); animation: slideDownFade 1s forwards; }
    header h1 { font-size:2.2rem; margin:10px 0; opacity:0; transform: translateY(-50px); animation: slideDownFade 1s 0.3s forwards; }
    header p { font-size:1.1rem; opacity:0; transform: translateY(-50px); animation: slideDownFade 1s 0.6s forwards; }

    @keyframes slideDownFade {
      from { opacity:0; transform: translateY(-50px); }
      to { opacity:1; transform: translateY(0); }
    }

    /* ===== Navigation ===== */
    nav {
      background:#fff;
      display:flex;
      justify-content:center;
      gap:20px;
      padding:12px;
      box-shadow:0 2px 8px rgba(0,0,0,0.1);
    }
    nav a {
      text-decoration:none;
      color:#1e90ff;
      font-weight:bold;
    }
    nav a:hover { text-decoration:underline; }

    /* ===== Section ===== */
    section {
      padding:50px 20px;
      max-width:1200px;
      margin:auto;
    }

    /* ===== Boutons ===== */
    .btn-primary {
      display:inline-block;
      padding:12px 20px;
      background:#1e90ff;
      color:white;
      border-radius:8px;
      text-decoration:none;
      font-weight:bold;
    }
    .btn-primary:hover { background:#0b78e3; }

    /* ===== Table ===== */
    .table-container { overflow-x:auto; margin-top:25px; }

    table {
      width:100%;
      min-width:900px;
      border-collapse:collapse;
      background:white;
      box-shadow:0 10px 25px rgba(0,0,0,0.08);
      border-radius:12px;
      overflow:hidden;
    }

    th, td {
      padding:14px;
      border-bottom:1px solid #eee;
      text-align:left;
    }

    th {
      background:#1e90ff;
      color:white;
    }

    tr:nth-child(even) { background:#f9fbff; }

    .badge {
      padding:6px 12px;
      border-radius:20px;
      color:white;
      font-weight:bold;
      font-size:0.85rem;
    }

    .download-btn {
      padding:10px 15px;
      border-radius:8px;
      text-decoration:none;
      font-weight:bold;
      color:white;
      background:#198754;
    }

    .download-btn.wait {
      background:#ffc107;
      color:#333;
    }

    .blink {
      animation: blink 1s linear infinite;
    }

    @keyframes blink {
      50% { opacity:0.5; }
    }

    footer {
      background:#222;
      color:#ccc;
      text-align:center;
      padding:20px;
      margin-top:40px;
    }

    .whatsapp {
      position:fixed;
      bottom:20px;
      right:20px;
      background:#25d366;
      color:white;
      padding:14px 18px;
      border-radius:50px;
      text-decoration:none;
      font-weight:bold;
      box-shadow:0 8px 20px rgba(0,0,0,0.3);
    }
  </style>
</head>

<body>

<div id="offline-banner">‚ö†Ô∏è Veuillez activer votre connexion Internet pour certaines fonctionnalit√©s</div>

<header>
  <a href="index.html"><img src="images/logo.png" alt="Libert_Toi_AutoDi"></a>
  <h1>Espace Client</h1>
  <p>Suivez vos fichiers et l‚Äôavancement de vos travaux</p>
</header>

<nav>
  <a href="index.html">Accueil</a>
  <a href="formations.html">Formations</a>
  <a href="outils.html">Outils</a>
</nav>

<section>

  <p>
    <a class="btn-primary" target="_blank"
       href="https://docs.google.com/forms/d/e/1FAIpQLSepncg1m0RuqcmdturorHndSvCw12o9JmwFRxHvU8h4gf77GQ/viewform">
       üì§ D√©poser un fichier
    </a>
  </p>

  <p>
    <input id="idInput" placeholder="Entrez votre ID client"
           style="padding:10px;border-radius:6px;border:1px solid #ccc;width:260px;">
    <button id="searchBtn" class="btn-primary">Rechercher</button>
    <span id="loading" style="display:none;margin-left:10px;">Chargement...</span>
  </p>

  <div class="table-container">
    <table>
      <thead>
        <tr>
          <th>Email</th>
          <th>Nom & Pr√©nom</th>
          <th>WhatsApp</th>
          <th>Fichier</th>
          <th>Description</th>
          <th>Statut</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody id="clientInfo"></tbody>
    </table>
  </div>

</section>

<footer>
  <p>¬© 2026 Libert_Toi_AutoDi</p>
</footer>

<a id="whatsappBtn" class="whatsapp" href="#" target="_blank">üí¨ WhatsApp</a>

<script>
const endpoint = "https://script.google.com/macros/s/AKfycbxKymOFmez4Oz6opGEPo909UWvkQh8EcVmKpB456FTuF64L3fIVSlBntz1a0ID78N0/exec";
const whatsappNumber = "22665219538";

const tbody = document.getElementById("clientInfo");
const idInput = document.getElementById("idInput");
const loading = document.getElementById("loading");
const whatsappBtn = document.getElementById("whatsappBtn");

let currentClientName="", currentClientId="", currentStatut="";

function badge(statut){
  statut=(statut||"").toUpperCase();
  let c="#6c757d";
  if(statut==="EN ATTENTE")c="#ffc107";
  if(statut==="EN COURS")c="#0d6efd";
  if(statut==="TERMIN√â")c="#198754";
  return `<span class="badge" style="background:${c}">${statut}</span>`;
}

function drive(url){
  const m=url?.match(/\/d\/([^/]+)/);
  return m?`https://drive.google.com/uc?export=download&id=${m[1]}`:url;
}

async function loadClient(){
  const id=idInput.value.trim();
  if(!id) return;
  tbody.innerHTML="";
  loading.style.display="inline";
  currentClientId=id;

  const res=await fetch(`${endpoint}?id=${encodeURIComponent(id)}`);
  const data=await res.json();

  if(!data.length){
    tbody.innerHTML=`<tr><td colspan="7">‚ùå Aucun dossier trouv√©</td></tr>`;
    loading.style.display="none";
    return;
  }

  data.forEach(c=>{
    currentClientName=c["Nom & Pr√©nom"]||"Client";
    currentStatut=c.statut||"EN ATTENTE";
    let action=`<span class="download-btn wait">‚è≥ En attente</span>`;
    if(c.lien && currentStatut==="TERMIN√â"){
      action=`<a class="download-btn blink" target="_blank" href="${drive(c.lien)}">üì• T√©l√©charger</a>`;
    }
    tbody.innerHTML+=`
      <tr>
        <td>${c["Adresse e-mail"]||""}</td>
        <td>${c["Nom & Pr√©nom"]||""}</td>
        <td>${c["Num√©ro WhatsApp"]||""}</td>
        <td>${c["D√©p√¥t de fichier"]||""}</td>
        <td>${c["Expliquez-nous le travail attendu"]||""}</td>
        <td>${badge(currentStatut)}</td>
        <td>${action}</td>
      </tr>`;
  });

  whatsappBtn.href=`https://wa.me/${whatsappNumber}?text=${encodeURIComponent(
    `Bonjour, je suis ${currentClientName} (ID ${currentClientId}). Statut : ${currentStatut}`
  )}`;

  loading.style.display="none";
  idInput.value="";
}

document.getElementById("searchBtn").onclick=loadClient;

// Offline
const banner=document.getElementById("offline-banner");
function online(){ navigator.onLine?banner.classList.remove("show"):banner.classList.add("show"); }
window.addEventListener("online",online);
window.addEventListener("offline",online);
online();
</script>

</body>
</html>