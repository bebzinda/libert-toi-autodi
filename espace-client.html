<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Espace Client | Libert_Toi_AutoDi</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="css/style.css">

<style>
.table-container { overflow-x: auto; width: 100%; margin-top: 20px; }
table { min-width: 900px; border-collapse: collapse; width: 100%; }
th, td { border: 1px solid #ccc; padding: 10px; text-align: left; }
th { background: #1e90ff; color: white; }
tr:nth-child(even) { background: #f4f4f4; }

.badge { padding: 4px 10px; border-radius: 12px; color: white; font-weight: bold; }
.encours { background: #fd7e14; }
.termine { background: #5cb85c; }
.attente { background: #f0ad4e; }

.btn-primary {
  display: inline-block;
  padding: 10px 18px;
  background: #1e90ff;
  color: white;
  border-radius: 6px;
  text-decoration: none;
  margin-bottom: 15px;
}

#idInput {
  padding: 8px;
  width: 250px;
  border-radius: 5px;
  border: 1px solid #ccc;
}

#searchBtn {
  padding: 8px 16px;
  border-radius: 5px;
  border: none;
  background: #1e90ff;
  color: white;
  cursor: pointer;
}

#searchBtn:hover { background: #0b78e3; }

#loading { display: none; margin-left: 10px; font-style: italic; }

/* === BOUTON WHATSAPP FLOTTANT === */
.whatsapp-float {
  position: fixed;
  bottom: 25px;
  right: 25px;
  background: #25d366;
  color: white;
  border-radius: 50px;
  padding: 14px 20px;
  font-weight: bold;
  text-decoration: none;
  box-shadow: 0 8px 20px rgba(0,0,0,0.2);
  z-index: 999;
  display: flex;
  align-items: center;
  gap: 10px;
}

.whatsapp-float:hover {
  background: #1ebe5d;
}

/* BOUTON T√âL√âCHARGER CLIGNOTANT */
.blink {
  animation: blinker 1s linear infinite;
}

@keyframes blinker {
  50% { opacity: 0.5; }
}
</style>
</head>

<body>

<header class="site-header">
  <h1>Espace Client</h1>
  <p>Suivez vos fichiers et l‚Äôavancement de vos travaux</p>
</header>

<nav class="navbar">
  <a href="index.html">Accueil</a>
  <a href="formations.html">Formations</a>
  <a href="outils.html">Outils</a>
</nav>

<main>

<!-- Lien d√©p√¥t fichier -->
<p>
  <a href="https://docs.google.com/forms/d/e/1FAIpQLSepncg1m0RuqcmdturorHndSvCw12o9JmwFRxHvU8h4gf77GQ/viewform"
     target="_blank" class="btn-primary">
     üì§ D√©poser un fichier
  </a>
</p>

<!-- Recherche par ID client -->
<p>
  <input type="text" id="idInput" placeholder="Entrez votre ID">
  <button id="searchBtn">Rechercher</button>
  <span id="loading">Chargement...</span>
</p>

<div class="table-container">
  <table id="clientTable">
    <thead>
      <tr>
        <th>Email</th>
        <th>Nom & Pr√©nom</th>
        <th>WhatsApp</th>
        <th>Fichier</th>
        <th>Description</th>
        <th>Statut</th>
        <th>Lien</th>
      </tr>
    </thead>
   <tbody id="clientInfo"></tbody>
  </table>

  <h2>üì¶ Vos outils</h2>
  <table>
    <thead>
      <tr>
        <th>Outil</th>
        <th>Statut</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody id="toolsTable"></tbody>
  </table>
</div>

</main>

<footer class="site-footer">
<p>Libert_Toi_AutoDi ‚Äì Espace Client</p>
</footer>

<!-- BOUTON WHATSAPP -->
<a id="whatsappBtn" class="whatsapp-float" href="#" target="_blank">
  üí¨ WhatsApp
</a>

<script>
const endpoint = "https://script.google.com/macros/s/AKfycbxqngNcSXsl-QndWZnUt19_XPBlv_9iF28g9AAizJ6slhsmMj6uI6mBgxRRByAx_So/exec";
const whatsappNumber = "22665219538";

const tbody = document.querySelector("#clientInfo");
const idInput = document.querySelector("#idInput");
const searchBtn = document.querySelector("#searchBtn");
const loading = document.querySelector("#loading");
const whatsappBtn = document.querySelector("#whatsappBtn");

let currentClientName = "";
let currentClientId = "";
let currentStatut = "";

/* ===== COULEUR STATUT ===== */
function getStatusBadge(statut) {
  statut = (statut || "").toUpperCase();

  let color = "#6c757d"; // gris par d√©faut
  if (statut === "EN ATTENTE") color = "#f0ad4e";
  if (statut === "EN COURS") color = "#0d6efd";
  if (statut === "TERMIN√â") color = "#5cb85c";

  return `<span class="badge" style="background:${color}">${statut}</span>`;
}

/* ===== CHARGEMENT CLIENT ===== */
async function loadClientById(id) {
  if (!id) return;

  tbody.innerHTML = "";
  loading.style.display = "inline";
  currentClientId = id;

  try {
    const res = await fetch(`${endpoint}?id=${encodeURIComponent(id)}`);
    const data = await res.json();

    if (!data.length) {
      tbody.innerHTML =
        `<tr><td colspan="7">‚ùå Aucun dossier trouv√© pour cet ID.</td></tr>`;
      return;
    }

    data.forEach(client => {
      currentClientName = client["Nom & Pr√©nom"] || "Client";
      currentStatut = client.statut || "EN ATTENTE";

      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${client["Adresse e-mail"] || ""}</td>
        <td>${client["Nom & Pr√©nom"] || ""}</td>
        <td>${client["Num√©ro WhatsApp"] || ""}</td>
        <td>${client["D√©p√¥t de fichier"] || ""}</td>
        <td>${client["Expliquez-nous le travail attendu"] || ""}</td>
        <td style="text-align:center">
          ${getStatusBadge(currentStatut)}
        </td>
        <td>
          ${client.lien ? `<a href="${client.lien}" target="_blank">üîó Voir</a>` : ""}
        </td>
      `;
      tbody.appendChild(tr);
    });

    updateWhatsAppLink();

  } catch (err) {
    console.error(err);
    tbody.innerHTML =
      `<tr><td colspan="7">‚ö†Ô∏è Erreur de chargement.</td></tr>`;
  } finally {
    loading.style.display = "none";
    idInput.value = "‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢";
  }
}

/* ===== WHATSAPP ===== */
function updateWhatsAppLink() {
  const message =
`Bonjour Libert_Toi_AutoDi,
Je suis ${currentClientName}.
ID client : ${currentClientId}.
Statut de mon dossier : ${currentStatut}.
Je souhaite avoir plus d'informations.`;

  whatsappBtn.href =
    `https://wa.me/${whatsappNumber}?text=${encodeURIComponent(message)}`;
}

/* ===== EVENTS ===== */
searchBtn.addEventListener("click", () => {
  loadClientById(idInput.value.trim());
});

window.addEventListener("load", () => {
  const params = new URLSearchParams(window.location.search);
  const id = params.get("id");
  if (id) loadClientById(id);
});
</script>

</body>
</html>